<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE project [
	<!ENTITY antpp SYSTEM "file:build.antpp.xml">
]>
<!--
#IFNDEF ALT_LICENSE
                           ThinWire(R) RIA Ajax Framework
                 Copyright (C) 2003-2007 Custom Credit Systems

  This library is free software; you can redistribute it and/or modify it under
  the terms of the GNU Lesser General Public License as published by the Free
  Software Foundation; either version 2.1 of the License, or (at your option) any
  later version.

  This library is distributed in the hope that it will be useful, but WITHOUT ANY
  WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
  PARTICULAR PURPOSE. See the GNU Lesser General Public License for more details.

  You should have received a copy of the GNU Lesser General Public License along
  with this library; if not, write to the Free Software Foundation, Inc., 59
  Temple Place, Suite 330, Boston, MA 02111-1307 USA

  Users who would rather have a commercial license, warranty or support should
  contact the following company who invented, built and supports the technology:
  
                Custom Credit Systems, Richardson, TX 75081, USA.
   	            email: info@thinwire.com    ph: +1 (888) 644-6405
 	                        http://www.thinwire.com
#ENDIF
#IFDEF ALT_LICENSE
#LICENSE_HEADER#
#ENDIF
#VERSION_HEADER#
-->
<project name="ThinWire RIA Ajax Framework" default="help" basedir=".">
	<target name="-init">
		<!-- Path locations -->
		<property name="path.library" value="../lib"/>
		<property name="path.temp" value="../temp"/>
		<property name="path.source" value="${path.temp}_src"/>
		<property name="path.binary" value="${path.temp}_bin"/>
		
		<!-- Preprocessor Defines -->
		<property name="PREPROCESSOR_DEFINES" value=""/>
		
		<!-- Delete working folders -->
		<delete dir="${path.temp}"/>
		<delete dir="${path.source}"/>
		<delete dir="${path.binary}"/>

		<!-- Create empty working folders -->
		<mkdir dir="${path.temp}"/>
		<mkdir dir="${path.source}"/>
		<mkdir dir="${path.binary}"/>

		<!-- Copy source files to working folder -->
		<copy todir="${path.source}" overwrite="true">
			<fileset dir="../src" defaultexcludes="yes">
				<include name="**/*"/>
			</fileset>
		</copy>
		
		<!-- Load version information from internal properties file -->
		<loadproperties srcFile="${path.source}/thinwire/ui/resources/versionInfo.properties"/>		
			
		<!-- Preprocessor Constants -->
		<property name="VERSION_HEADER" value=" [ v${versionInfo.productVersion} ] ${PREPROCESSOR_DEFINES}"/>
		
		<!-- Include Preprocessor Engine and Run it Over The Files -->
		&antpp;
		<antpp dir="${path.source}" defines="${PREPROCESSOR_DEFINES}">
			<include name="thinwire/**/*.java"/>
			<include name="thinwire/**/*.js"/>
			<include name="thinwire/**/*.html"/>
	    </antpp>
		
		<tstamp/>
	</target>
	
	<!-- Compile the framework, create a jar and create a distribution zip -->
	<target name="dist" depends="-init,-compile,-jso,-jar,-zip,-clean"/>
	
	<!-- Compile the framework, create a jar, translate to Java 1.4 and create a distribution zip -->
	<target name="dist14" depends="-init,-compile,-jso,-retroweaver,-jar,-zipJava14,-clean"/>
	
	<target name="-compile">
		<echo message="Compiling Java Source"/>
		
		<javac srcdir="${path.source}" destdir="${path.temp}" target="1.5" source="1.5" debug="yes">
			<classpath>
				<fileset dir="./" includes="**/*.jar"/>
				<fileset dir="${path.library}" includes="**/*.jar"/>
			</classpath>
	    </javac>

		<copy todir="${path.temp}" overwrite="true">
			<fileset dir="${path.source}" defaultexcludes="yes">
				<include name="thinwire/render/**/resources/*.*"/>
				<include name="thinwire/ui/**/resources/*.*"/>
				<include name="thinwire/util/**/resources/*.*"/>				
				<exclude name="thinwire/render/web/resources/Logger.js"/>
			</fileset>
		</copy>		
	</target>
	
	<target name="-jso">
		<echo message="Applying ThinWire JavaScript Optimizer for Smaller Client-Side Code"/>
					
		<taskdef name="jso" classname="thinwire.tools.jso.AntTask">
			<classpath>
				<fileset dir="./" includes="*/**"/>
			</classpath>
		</taskdef>

		<jso srcdir="${path.temp}" destdir="${path.temp}" namemap="thinwire/render/web/resources/Main.js">
			<include name="thinwire/render/web/resources/*.js"/>
			<include name="thinwire/ui/layout/resources/*.js"/>
		</jso>

		
		<!--<jso srcdir="" destdir="${path.temp}"
			includes="/thinwire/render/web/resources/*.js;/thinwire/ui/layout/resources/*.js"/>-->
    </target>
	
	<target name="-retroweaver">
		<echo message="Applying Retroweaver Translation for Java 1.4 Support"/>
		
		<taskdef name="retroweaver" classname="com.rc.retroweaver.ant.RetroWeaverTask">
	    	<classpath>
				<fileset dir="./" includes="*/**"/>
	    	</classpath>
	    </taskdef>
		
		<retroweaver srcdir="${path.temp}" target="1.4"/>
	</target>
	
	<target name="-jar">
		<jar jarfile="../${versionInfo.originalFilename}" basedir="${path.temp}">
			<manifest>
				<attribute name="Manifest-Version" value="2.0"/>
				<attribute name="Built-By" value="${user.name}"/>
				<attribute name="Main-Class" value="thinwire.ui.Application"/>				

				<section name="thinwire/render/web/">
					<attribute name="Implementation-Title" value="ThinWire RIA Ajax Framework Web Renderer"/>
					<attribute name="Implementation-Version" value="${versionInfo.productVersion}"/>
					<attribute name="Implementation-Vendor" value="${versionInfo.companyName}"/>
				</section>

				<section name="thinwire/ui/">
					<attribute name="Implementation-Title" value="ThinWire RIA Ajax Framework"/>
					<attribute name="Implementation-Version" value="${versionInfo.productVersion}"/>
					<attribute name="Implementation-Vendor" value="${versionInfo.companyName}"/>
				</section>

				<section name="thinwire/util/">
					<attribute name="Implementation-Title" value="ThinWire RIA Ajax Framework Utilities"/>
					<attribute name="Implementation-Version" value="${versionInfo.productVersion}"/>
					<attribute name="Implementation-Vendor" value="${versionInfo.companyName}"/>
				</section>        
			</manifest>
		</jar>		
	</target>
	
	<target name="-zip">
		<copy todir="${path.binary}" flatten="true">
			<fileset dir="../">
				<include name="${versionInfo.originalFilename}"/>
				<include name="LICENSE.txt"/>
			</fileset>
			
			<fileset dir="${path.library}" includes="*/**"/>
		</copy>	
			
		<zip destfile="../thinwire-${versionInfo.productVersion}.zip" basedir="${path.binary}" filesonly="true"/>
	</target>
	
	<target name="-zipJava14">
		<copy todir="${path.binary}" flatten="true">
			<fileset dir="../">
				<include name="${versionInfo.originalFilename}"/>
				<include name="LICENSE.txt"/>
			</fileset>
			
			<fileset dir="${path.library}" includes="*/**"/>
			<fileset dir="./" includes="retroweaver*/retroweaver-rt*.jar"/>
		</copy>
		
		<zip destfile="../thinwire-${versionInfo.productVersion}-java14.zip" basedir="${path.binary}" filesonly="true"/>
	</target>	
	
	<target name="-clean">
		<delete dir="${path.temp}"/>
		<delete dir="${path.source}"/>
		<delete dir="${path.binary}"/>
		<delete file="../${versionInfo.originalFilename}"/>
	</target>
	
	<!-- Archive the source, including everything needed to build the framework -->
	<target name="source" depends="-init,-zipSource"/>
	
	<target name="-zipSource">		
		<copy todir="${path.temp}" overwrite="true">
			<fileset dir="../" defaultexcludes="yes">
				<include name="lib/**/*"/>
				<include name="build/**/*"/>
				<include name="LICENSE.txt"/>
				<include name="README.txt"/>
			</fileset>
		</copy>
		<copy todir="${path.temp}/src" overwrite="true">
			<fileset dir="${path.source}" defaultexcludes="yes"/>
		</copy>

		<zip destfile="../thinwire-${versionInfo.productVersion}-src.zip"><fileset dir="${path.temp}"/></zip>
	</target>
	
	<!-- Build the API javadoc and archive it -->
	<target name="javadoc" depends="-init,-createJavaDoc,-clean"/>		
	
	<target name="-createJavaDoc">
		<javadoc destdir="${path.temp}"
			author="false"
			version="false"
			use="false"
			access="protected"
			windowtitle="ThinWire RIA Ajax Framework API ${VERSION_HEADER}"
			doctitle="ThinWire RIA Ajax Framework API ${VERSION_HEADER}"
			stylesheetfile="javadoc/stylesheet.css">

			<fileset dir="${path.source}" defaultexcludes="yes">
				<include name="thinwire/ui/**/*.java"/>
				<include name="thinwire/util/**/*.java"/>
			</fileset>
		
			<bottom><![CDATA[
				<div class="FooterText"><a href="http://www.thinwire.com">ThinWire&reg;</a> is a registered of <a href="http://www.customcreditsystems.com">Custom Credit Systems</a>&nbsp;&nbsp;Copyright &copy; 2007 All rights reserved.</div>
				<div class="FooterButtons">
				  <a href="http://www.opensource.org/licenses/lgpl-license.php"><img src="http://opensource.org/trademarks/open_source_button.png" width="88" height="31" alt="ThinWire_is_Open_Source_under_the_terms_of_the_LGPLv2.1"/></a>
				  <a href="http://sourceforge.net/projects/thinwire"><img src="http://sflogo.sourceforge.net/sflogo.php?group_id=170706&amp;type=1" width="88" height="31" alt="SourceForge.net_Project_Page"/></a>
				  <a href="http://www.java.net"><img src="http://today.java.net/images/javanet_button_90.gif" border="0" width="90" height="25" alt="java.net_Member"/></a>
				  <a href="http://digg.com/programming/ThinWire_Ajax_Framework_Now_Available_Under_LGPL"><img src="http://thinwire.sourceforge.net/DiggButtonLarge.png" width="165" height="31" alt="Support_ThinWire,_Digg_our_Story"/></a>  
				</div>
		    ]]></bottom>
		</javadoc>

		<replaceregexp match="(parent[.]document[.]title[=].*?;)" replace="try {\1} catch (e) {}" flags="g">
			<fileset dir="${path.temp}" includes="**/*.html"/>
		</replaceregexp>		
		
		<copy todir="${path.temp}" overwrite="true">
			<fileset dir="${path.source}" includes="thinwire/**/doc-files/*.*"/>
		</copy>

		<copy todir="${path.temp}/resources" overwrite="true">
			<fileset dir="javadoc" includes="*.png"/>
		</copy>

		<zip destfile="../thinwire-${versionInfo.productVersion}-doc.zip">
			<fileset dir="${path.temp}"/>
		</zip>
	</target>
	
	<target name="help">
<echo>               ThinWire(TM) RIA Ajax Framework
         Copyright (C) 2003-2007 Custom Credit Systems

The following build targets are available:

 dist        compile the framework, create a jar and package
	         it along with other required runtime files into
             a distribution zip.

 dist14      compile a Java 1.4 compatible version of the
             framework, create a jar and package it along with
             other required runtime files into a distribution
             zip.
	
 source      create a source only distribution that contains
             everything necessary to build the framework.

 javadoc     generate the framework API documentation and
             package it into a javadoc only distribution zip
             file.
</echo>
	</target>
</project>
